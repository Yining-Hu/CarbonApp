<html>
    <body>
        <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
        <script>
            mermaid.initialize({ startOnLoad: true });
        </script>

        Escrow sequence diagram:
        <div class="mermaid">
            sequenceDiagram;
            autonumber
                participant Buyer
                participant Seller
                participant Escrow.sol
                participant DigitalTwin.sol
                Seller->>DigitalTwin.sol: Mint an HalalBox NFT for a box of halal meat.
                Seller->>Escrow.sol: Put the HalalBox on offer.
                Buyer->>Escrow.sol: Make a deposit for HalalBox.
                activate Escrow.sol
                Note right of Buyer: This triggers the timer for seller to verify halal and redeem deposit.
                Seller->>DigitalTwin.sol: ML verification of the box of halal meat.
                Escrow.sol-->>DigitalTwin.sol: Retrieve ML verification result.
                Buyer->>Escrow.sol: Access ML verification result, and update verification status.
                alt is halal
                Seller->>Escrow.sol: Redeem remaining payment before timeout.
                deactivate Escrow.sol
                else is not halal
                Buyer->>Escrow.sol: Claim refund after timeout.
                end
        </div>
    </body>
</html>